import{af as B,d as N,ag as q,A,a1 as $,ah as H,ai as W,aj as J,ak as F,al as O,u as Q,r as T,o as M,n as I,w as c,b as U,E as X,a as p,g as a,h as P,D as w,L as Y,j as Z,k as ee,am as ne,a3 as te,G as oe,H as re,M as ae,N as ie,I as le,an as de,ao as ue,J as se}from"./index-61080a5f.js";/* empty css                     *//* empty css                     *//* empty css                    *//* empty css                 */import{W as fe}from"./md-editor-v3-2a00f098.js";import{b as me}from"./my_function-9ea274aa.js";var ce=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],pe=function(e){return ce.map(function(r){return r.toLowerCase()}).indexOf(e.toLowerCase())!==-1},ve=function(e,r,t){Object.keys(r).filter(pe).forEach(function(i){var s=r[i];typeof s=="function"&&(i==="onInit"?s(e,t):t.on(i.substring(2),function(f){return s(f,t)}))})},ge=function(e,r,t,i){var s=e.modelEvents?e.modelEvents:null,f=Array.isArray(s)?s.join(" "):s;B(i,function(n,v){t&&typeof n=="string"&&n!==v&&n!==t.getContent({format:e.outputFormat})&&t.setContent(n)}),t.on(f||"change input undo redo",function(){r.emit("update:modelValue",t.getContent({format:e.outputFormat}))})},ye=function(e,r,t,i,s,f){i.setContent(f()),t.attrs["onUpdate:modelValue"]&&ge(r,t,i,s),ve(e,t.attrs,i)},j=0,R=function(e){var r=Date.now(),t=Math.floor(Math.random()*1e9);return j++,e+"_"+t+j+String(r)},_e=function(e){return e!==null&&e.tagName.toLowerCase()==="textarea"},L=function(e){return typeof e>"u"||e===""?[]:Array.isArray(e)?e:e.split(" ")},be=function(e,r){return L(e).concat(L(r))},he=function(e){return e==null},z=function(){return{listeners:[],scriptId:R("tiny-script"),scriptLoaded:!1}},we=function(){var e=z(),r=function(s,f,n,v){var u=f.createElement("script");u.referrerPolicy="origin",u.type="application/javascript",u.id=s,u.src=n;var k=function(){u.removeEventListener("load",k),v()};u.addEventListener("load",k),f.head&&f.head.appendChild(u)},t=function(s,f,n){e.scriptLoaded?n():(e.listeners.push(n),s.getElementById(e.scriptId)||r(e.scriptId,s,f,function(){e.listeners.forEach(function(v){return v()}),e.scriptLoaded=!0}))},i=function(){e=z()};return{load:t,reinitialize:i}},ke=we(),Ce=function(){return typeof window<"u"?window:global},C=function(){var e=Ce();return e&&e.tinymce?e.tinymce:null},Se={apiKey:String,cloudChannel:String,id:String,init:Object,initialValue:String,inline:Boolean,modelEvents:[String,Array],plugins:[String,Array],tagName:String,toolbar:[String,Array],modelValue:String,disabled:Boolean,tinymceScriptSrc:String,outputFormat:{type:String,validator:function(e){return e==="html"||e==="text"}}},S=globalThis&&globalThis.__assign||function(){return S=Object.assign||function(e){for(var r,t=1,i=arguments.length;t<i;t++){r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},S.apply(this,arguments)},xe=function(e,r,t,i){return e(i||"div",{id:r,ref:t})},Ee=function(e,r,t){return e("textarea",{id:r,visibility:"hidden",ref:t})},Ve=N({props:Se,setup:function(e,r){var t=e.init?S({},e.init):{},i=q(e),s=i.disabled,f=i.modelValue,n=i.tagName,v=A(null),u=null,k=e.id||R("tiny-vue"),x=e.init&&e.init.inline||e.inline,E=!!r.attrs["onUpdate:modelValue"],V=!0,g=e.initialValue?e.initialValue:"",o="",y=function(m){return E?function(){return f!=null&&f.value?f.value:""}:function(){return m?g:o}},l=function(){var m=y(V),d=S(S({},t),{readonly:e.disabled,target:v.value,plugins:be(t.plugins,e.plugins),toolbar:e.toolbar||t.toolbar,inline:x,setup:function(b){u=b,b.on("init",function(D){return ye(D,e,r,b,f,m)}),typeof t.setup=="function"&&t.setup(b)}});_e(v.value)&&(v.value.style.visibility=""),C().init(d),V=!1};B(s,function(m){var d;u!==null&&(typeof((d=u.mode)===null||d===void 0?void 0:d.set)=="function"?u.mode.set(m?"readonly":"design"):u.setMode(m?"readonly":"design"))}),B(n,function(m){var d;E||(o=u.getContent()),(d=C())===null||d===void 0||d.remove(u),O(function(){return l()})}),$(function(){if(C()!==null)l();else if(v.value&&v.value.ownerDocument){var m=e.cloudChannel?e.cloudChannel:"6",d=e.apiKey?e.apiKey:"no-api-key",b=he(e.tinymceScriptSrc)?"https://cdn.tiny.cloud/1/".concat(d,"/tinymce/").concat(m,"/tinymce.min.js"):e.tinymceScriptSrc;ke.load(v.value.ownerDocument,b,l)}}),H(function(){C()!==null&&C().remove(u)}),x||(W(function(){V||l()}),J(function(){var m;E||(o=u.getContent()),(m=C())===null||m===void 0||m.remove(u)}));var h=function(m){var d;o=u.getContent(),(d=C())===null||d===void 0||d.remove(u),t=S(S({},t),m),O(function(){return l()})};return r.expose({rerender:h,getEditor:function(){return u}}),function(){return x?xe(F,k,v,e.tagName):Ee(F,k,v)}}});const De=P("div",{class:"el-upload__tip text-red"}," 限制上传一个文件，切文件大小在100MB以内 ",-1),Me={class:"dialog-footer"},Ie=null,Le=N({__name:"ForumAdd",setup(e){const r=Q(),t=A(),i=A(),s={language:"zh_CN",toolbar:"undo redo | blocks fontfamily fontsize | bold italic underline strikethrough | link image media table mergetags | addcomment showcomments | spellcheckdialog a11ycheck typography | align lineheight | checklist numlist bullist indent outdent | emoticons charmap | removeformat"};let n=T({forums:[Z],keywords:[ee],form:{title:"",profile:"",md_content:"",rtf_content:"",content_type:0,keyword:[],annex:Ie},errors:{title:"",profile:"",md_content:"",rtf_content:"",keyword:"",annex:""}});const v=T({title:[{required:!0,message:"请输入标题",trigger:"blur"}],content:[{required:!0,message:"请输入内容",trigger:"blur"}]}),u=g=>{n.form.annex=g.raw},k=g=>{i.value.clearFiles();const o=g[0];o.uid=ne(),i.value.handleStart(o)},x=()=>{U.get("/api/web/forum/add").then(g=>{g.data.status===!0?n.keywords=g.data.keywords:console.log("error")}).catch(g=>{console.log(g)})},E=g=>{if(g){for(let o in n.errors)n.errors[o]="";if(n.form.annex&&n.form.annex.size>1024*1024*100){n.errors.annex=`请将文件大小控制在100.0 MB以下。当前文件大小${me(n.form.annex.size)}`;return}g.validate(o=>{if(o){let y=new FormData;y.append("title",n.form.title),y.append("profile",n.form.profile),y.append("rtf_content",n.form.rtf_content),y.append("md_content",n.form.md_content),y.append("content_type",n.form.content_type.toString());for(let l of n.form.keyword)y.append("keyword",l);y.append("annex",n.form.annex),U.post("/api/web/forum/add",y,{headers:{"Content-Type":"multipart/form-data"}}).then(l=>{if(l.data.status===!0)n.form.title="",n.form.profile="",n.form.rtf_content="",n.form.md_content="",n.form.keyword=[],n.form.annex="",te({message:"上传成功,等待管理员审核",type:"success"});else for(let h in l.data.errors)n.errors[h]=l.data.errors[h][0]}).catch(l=>{console.log(l)})}else return!1})}},V=async(g,o)=>{const y=await Promise.all(g.map(l=>new Promise((h,m)=>{const d=new FormData;d.append("img",l),U.post("/api/web/forum/img/add",d,{headers:{"Content-Type":"multipart/form-data"}}).then(b=>h(b)).catch(b=>m(b))})));o(y.map(l=>l.data.url))};return n.forums=[],x(),(g,o)=>{const y=oe,l=re,h=ae,m=ie,d=le,b=de,D=ue,K=se,G=X;return M(),I(G,{"max-height":"100%"},{default:c(()=>[p(K,{ref_key:"forum_add_form",ref:t,model:a(n).form,rules:v,"label-width":"120px","label-position":"top",style:{width:"90%",margin:"auto"}},{default:c(()=>[p(l,{label:"标题",error:a(n).errors.title,prop:"title"},{default:c(()=>[p(y,{modelValue:a(n).form.title,"onUpdate:modelValue":o[0]||(o[0]=_=>a(n).form.title=_)},null,8,["modelValue"])]),_:1},8,["error"]),p(l,{error:a(n).errors.profile,prop:"profile"},{label:c(()=>[P("span",null,[w("简介 "),p(m,{effect:"dark",content:"帮助读者快速了解内容",placement:"top"},{default:c(()=>[p(h,null,{default:c(()=>[p(a(Y))]),_:1})]),_:1})])]),default:c(()=>[p(y,{modelValue:a(n).form.profile,"onUpdate:modelValue":o[1]||(o[1]=_=>a(n).form.profile=_),placeholder:"请输入简介",clearable:"",type:"textarea",rows:"2",maxlength:"128","show-word-limit":""},null,8,["modelValue"])]),_:1},8,["error"]),a(n).form.content_type==0?(M(),I(l,{key:0,label:"富文本格式内容",error:a(n).errors.rtf_content},{label:c(()=>[w(" 富文本格式内容 "),p(d,{onClick:o[2]||(o[2]=_=>a(n).form.content_type=1)},{default:c(()=>[w("点击切换为Markdown")]),_:1}),p(a(Ve),{"api-key":"8hn75fp048fynpmqrn0289umwq8dms8ei538atwy2sglz5vn",modelValue:a(n).form.rtf_content,"onUpdate:modelValue":o[3]||(o[3]=_=>a(n).form.rtf_content=_),init:s},null,8,["modelValue"])]),_:1},8,["error"])):(M(),I(l,{key:1,label:"Markdown格式内容",error:a(n).errors.md_content},{label:c(()=>[w(" Markdown格式内容 "),p(d,{onClick:o[4]||(o[4]=_=>a(n).form.content_type=0)},{default:c(()=>[w("点击切换为富文本")]),_:1})]),default:c(()=>[p(a(fe),{modelValue:a(n).form.md_content,"onUpdate:modelValue":o[5]||(o[5]=_=>a(n).form.md_content=_),"toolbars-exclude":["save","github"],onOnUploadImg:V,style:{height:"500px","text-align":"left"}},null,8,["modelValue"])]),_:1},8,["error"])),p(l,{label:"关键词",error:a(n).errors.keyword},{default:c(()=>[p(b,{modelValue:a(n).form.keyword,"onUpdate:modelValue":o[6]||(o[6]=_=>a(n).form.keyword=_),data:a(n).keywords,props:{key:"id",label:"keyword"},filterable:""},null,8,["modelValue","data"])]),_:1},8,["error"]),p(l,{label:"附件",error:a(n).errors.annex},{default:c(()=>[p(D,{ref_key:"upload",ref:i,"show-file-list":"",limit:1,"auto-upload":!1,style:{width:"90%"},"on-change":(_,Ue)=>u(_),"on-exceed":k},{trigger:c(()=>[p(d,{type:"primary"},{default:c(()=>[w("选择文件")]),_:1})]),tip:c(()=>[De]),_:1},8,["on-change"])]),_:1},8,["error"])]),_:1},8,["model","rules"]),P("span",Me,[p(d,{onClick:o[7]||(o[7]=_=>a(r).back())},{default:c(()=>[w("取消")]),_:1}),p(d,{type:"primary",onClick:o[8]||(o[8]=_=>E(t.value))},{default:c(()=>[w("上传")]),_:1})])]),_:1})}}});export{Le as default};
